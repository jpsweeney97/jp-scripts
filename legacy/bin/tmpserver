#!/usr/bin/env bash
set -euo pipefail

# Name: tmpserver
# Category: web
# Description: Start a simple HTTP server for the current directory.
# Usage:
#   tmpserver           # serves on port 8000
#   tmpserver 9000      # serves on port 9000
#
# Notes:
# - Uses python3 -m http.server
# - Ctrl-C to stop.

usage() {
  sed -n '4,40p' "$0" | sed 's/^# \?//'
}

case "${1-}" in
  -h|--help)
    usage
    exit 0
    ;;
esac

PORT="${1-8000}"

if ! command -v python3 >/dev/null 2>&1; then
  printf 'Error: python3 not found (required for serve-here).\n' >&2
  exit 1
fi

printf 'Serving "%s" at:\n' "$(pwd)"
printf '  http://localhost:%s/\n' "$PORT"

# Best-effort network IP print (may fail silently if interface differs)
if command -v ipconfig >/dev/null 2>&1; then
  ip="$(ipconfig getifaddr en0 2>/dev/null || true)"
  if [ -n "$ip" ]; then
    printf '  http://%s:%s/\n' "$ip" "$PORT"
  fi
fi

python3 -m http.server "$PORT"
